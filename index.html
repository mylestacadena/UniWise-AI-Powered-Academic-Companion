<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>UniWise Chat</title>

  <!-- Bootstrap Icons -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
    rel="stylesheet"
  />

  <!-- Custom Styles -->
  <link rel="stylesheet" href="assets/css/style.css" />
</head>
<body>
  <!-- Toggle Button (always pinned left) -->
  <div class="toggle-btn">
    <i class="bi bi-list"></i>
  </div>

  <!-- Sidebar -->
  <div class="sidebar collapsed d-flex flex-column">
    <!-- Logo -->
    <div class="logo text-center my-3">
      <img src="assets/images/uniwiselogo.jpg" alt="Logo" class="img-fluid" />
      <h1 class="title mt-2 label">UniWise</h1>
    </div>

    <!-- Navigation -->
    <nav class="flex-grow-1">
      <ul class="nav flex-column">
        <li class="nav-item mb-2"><i class="bi bi-gear"></i><span class="label">Settings</span></li>
        <li class="nav-item mb-2"><i class="bi bi-clock-history"></i><span class="label">History</span></li>
        <li class="nav-item mb-2"><i class="bi bi-book"></i><span class="label">Resources</span></li>
      </ul>
    </nav>

    <!-- New Chat Button -->
    <button class="new-chat">
      <i class="bi bi-plus-circle"></i><span class="label">New Chat</span>
    </button>
  </div>

  <!-- Chat Container -->
  <div class="chat-container d-flex justify-content-center align-items-center">
    <div class="chat-box">
      <div class="chat-area"></div>

      <!-- Suggested Questions -->
      <div class="suggestions">
        <div class="suggestion-header">
          <span>Suggested Questions</span>
          <i class="bi bi-x close-suggestions"></i>
        </div>
        <div class="suggestion-buttons">
          <button>What academic strands do you offer?</button>
          <button>How can I apply?</button>
          <button>What are the tuition fees?</button>
          <button>Where is the campus located?</button>
          <button>Is there an entrance exam?</button>
        </div>
      </div>

      <!-- Input Area -->
      <div class="input-area d-flex">
        <input type="text" placeholder="Type a message..." id="user-input" />
        <button class="send-btn" id="send-btn"><i class="bi bi-send-fill"></i></button>
      </div>
    </div>
  </div>

  <!-- Custom JS -->
  <script src="assets/js/script.js"></script>

  <script>
// ========================
// Text-to-Speech Function
// ========================
function speakBotMessage(text) {
  if (!text) return;
  const synth = window.speechSynthesis;
  const utter = new SpeechSynthesisUtterance(text);
  utter.lang = "en-US";
  utter.rate = 1;   // speed of speech
  utter.pitch = 1;  // pitch of voice
  synth.speak(utter);
}

// ========================
// Display Bot Message
// ========================
function displayBotMessage(text) {
  const chatArea = document.querySelector(".chat-area");
  const botMsg = document.createElement("div");
  botMsg.classList.add("bot-message");
  botMsg.textContent = text;
  chatArea.appendChild(botMsg);
  chatArea.scrollTop = chatArea.scrollHeight;

  // Speak the message
  speakBotMessage(text);
}

// ========================
// Display User Message
// ========================
function displayUserMessage(text) {
  const chatArea = document.querySelector(".chat-area");
  const userMsg = document.createElement("div");
  userMsg.classList.add("user-message");
  userMsg.textContent = text;
  chatArea.appendChild(userMsg);
  chatArea.scrollTop = chatArea.scrollHeight;
}

// ========================
// Send Message to Rasa
// ========================
async function sendMessageToRasa(message) {
  const response = await fetch("http://localhost:5005/webhooks/rest/webhook", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ sender: "user", message: message })
  });

  const data = await response.json();

  data.forEach(reply => {
    // 1. Regular text messages
    if (reply.text) {
      displayBotMessage(reply.text);
    }

    // 2. Buttons
    if (reply.buttons) {
      reply.buttons.forEach(button => {
        if (button.title) displayBotMessage(button.title);
      });
    }

    // 3. Custom payloads (if using Rasa custom messages)
    if (reply.custom) {
      if (reply.custom.text) displayBotMessage(reply.custom.text);
      if (reply.custom.buttons) {
        reply.custom.buttons.forEach(btn => {
          if (btn.title) displayBotMessage(btn.title);
        });
      }
    }
  });
}

// ========================
// Handle User Input
// ========================
function handleUserInput() {
  const input = document.getElementById("user-input");
  const message = input.value.trim();
  if (!message) return;

  displayUserMessage(message);
  sendMessageToRasa(message);
  input.value = "";
}

// ========================
// Event Listeners
// ========================
// Send button
document.getElementById("send-btn").addEventListener("click", handleUserInput);

// Enter key
document.getElementById("user-input").addEventListener("keydown", (e) => {
  if (e.key === "Enter") handleUserInput();
});

</script>

  
</body>
</html>




